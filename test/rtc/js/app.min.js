(function(e){function t(e){var t=[],o=[],n=[],c='<option value="no">无</option>';const i=selectors.map(e=>e.value);if(selectors.forEach(e=>{for(;e.firstChild;)e.removeChild(e.firstChild);e.innerHTML=e.innerHTML+c}),e.forEach(e=>{var c=document.createElement("option");c.value=e.deviceId,"audioinput"===e.kind?(t.push(e.deviceId),c.text=e.label||`microphone ${F.length+1}`,F.appendChild(c)):"audiooutput"===e.kind?(n.push(e.deviceId),c.text=e.label||`speaker ${V.length+1}`,V.appendChild(c)):"videoinput"===e.kind&&(o.push(e.deviceId),c.text=e.label||`camera ${switchCamSelect.length+1}`,switchCamSelect.appendChild(c))}),sessionStorage.getItem("constraints")){sessionStorage.getItem("constraints")}selectors.forEach((e,t)=>{Array.prototype.slice.call(e.childNodes).some(e=>e.value===i[t])&&(e.value=i[t])}),sessionStorage.setItem("audio",t),sessionStorage.setItem("video",o),sessionStorage.setItem("audiooutput",n),M.FormSelect.init(document.querySelectorAll("select"))}function o(t){return e.stream=t,O.srcObject=t,navigator.mediaDevices.enumerateDevices()}function n(e){console.error("navigator.getUserMedia error: ",e),M.toast({html:e})}function c(){F.innerHTML="",V.innerHTML="",switchCamSelect.innerHTML="",r(),i()}function i(){e.stream&&e.stream.getTracks().forEach(e=>{e.stop()});const c=F.value,i=switchCamSelect.value;if("no"==c&&"no"==i)return void M.toast({html:"必须选择音频和视频中的一个！"});const a={audio:c&&"no"!=c&&""!=c&&{deviceId:c?{exact:c}:void 0},video:i&&"no"!=i&&""!=i&&{deviceId:i?{exact:i}:void 0}};navigator.mediaDevices.getUserMedia(a).then(o).then(t).catch(n)}function a(){O.srcObject.getTracks().forEach(e=>e.stop()),O.srcObject=null}function r(){navigator.mediaDevices.enumerateDevices().then(t).catch(n)}function s(e){var t=e.classList;t.contains("close-camera")?(v.openCam(),t.toggle("close-camera")):(v.closeCam(),t.toggle("close-camera"))}function l(e){$(".video-container").toggleClass("change"),$(".video-container").toggleClass("normal")}function u(e){var t=e.classList;t.contains("close-vol")?(document.querySelector("#remoteVideo").muted=!1,t.toggle("close-vol")):(document.querySelector("#remoteVideo").muted=!0,v.closeSpeaker(),t.toggle("close-vol"))}function d(e){var t=e.classList;t.contains("close-microphone")?(v.openMic(),t.toggle("close-microphone")):(v.closeMic(),t.toggle("close-microphone"))}function m(){sessionStorage.setItem("account",document.querySelector("#account").value),sessionStorage.setItem("password",document.querySelector("#password").value),h({account:document.querySelector("#account").value,password:document.querySelector("#password").value})}function h(t){var o=t&&t.account||sessionStorage.getItem("account"),n=t&&t.password||sessionStorage.getItem("password");o&&n?($('input[name="newAccount"]').val(o),$('input[name="newPassword"]').val(n),v=new e.App.WebRTC({account:o,password:n,domain:domain,wss:wss}),v.connect()):g.changePage("login"),$(".remoteControl").show(),$(".mic_btn").removeClass("off"),$(".video_btn").removeClass("off")}var g=e.App.common,v=null,p=document.querySelector("#linkman"),f=document.querySelector("#call"),S=document.querySelector("#cancel"),y=document.querySelector("#hangup"),w=document.querySelector("#reject"),q=document.querySelector("#answer"),k=document.querySelector("#change-camera"),C=document.querySelector(".mic_switch"),I=document.querySelector("#toggle-camera"),b=document.querySelector("#setRemoteMic"),R=document.querySelector("#setRemoteVideo"),D=document.querySelector("#setRemoteControl"),x=document.querySelector("#cancelRemoteControl"),A=document.querySelector("#volume"),E=document.querySelector("#featured"),L=document.querySelector("#window"),T=document.querySelector("#toggle-microphone"),F=(document.querySelector("#DTMF"),document.querySelector("#info-message"),document.querySelector("#sendInfo"),document.querySelector("#switch-microphone")),V=document.querySelector("#switch-audiooutput"),j=(document.querySelector("#change-frameRate"),document.querySelector("#save-contraints"),document.querySelector("#login")),H=document.querySelector("#logout"),O=document.querySelector("#test-video");FlyInnWeb.debug.disable("FlyInn:*");new VConsole;M.FormSelect.init(document.querySelectorAll("select")),M.Modal.init(document.querySelectorAll("#dialpad-modal"),{dismissible:!1}),M.Modal.init(document.querySelectorAll("#settings-modal"),{onOpenStart:c,onCloseEnd:a});M.FloatingActionButton.init(document.querySelectorAll(".fixed-action-btn"));$(".update").click(function(){var e={speed:120,constraints:{frameRate:15,width:640,aspectRatio:1.33333333},priority:"low"},t={low:512,medium:1024,high:1536,vhigh:2048},o={low:10,medium:15,high:20,vhigh:25},n={low:{width:640,height:360,aspectRatio:1.777777778},medium:{width:640,height:480,aspectRatio:1.33333333},high:{width:1280,height:720,aspectRatio:1.777777778}};e.speed=1e3*t[$(".speed").val()],e.constraints.frameRate=o[$(".fps").val()],e.constraints.width=n[$(".asp").val()].width,e.constraints.height=n[$(".asp").val()].height,e.constraints.aspectRatio=n[$(".asp").val()].aspectRatio,e.priority="vhight"===$(".asp").val()?"high":$(".asp").val(),v.testUpdate(e)}),$(".selectM").change(function(){$(this).val()&&v.updateConstraints($(this).val())}),$(".video-container").click(function(e){"VIDEO"==e.target.tagName&&$("#debug").toggleClass("hide")}),f.onclick=function(){p.value?(v.call(p.value),$(".caller").html(p.value)):M.toast({html:"请输入客服号码！"})},D.onclick=function(){v.sendInfo("setRemoteControl","text/plain")},x.onclick=function(){v.sendInfo("cancelRemoteControl","text/plain")},b.onclick=function(){v.sendInfo("setMic","text/plain")},R.onclick=function(){v.sendInfo("setVideo","text/plain")},C.onclick=function(e){},S.onclick=function(){v.cancel()},q.onclick=function(){v.answer()},y.onclick=function(){var e=confirm("确认结束?");1==e&&v.hangup()},w.onclick=function(){v.reject()},I.onclick=function(){s(this)},T.onclick=function(){d(this)},A.onclick=function(){u(this)},L.onclick=function(){l(this)},E.onclick=function(){navigator.getDisplayMedia?navigator.getDisplayMedia({video:!0}).then(e=>{e.addEventListener("inactive",e=>{v.switchStream()}),v.switchStream(e,"screen")}).catch(e=>{console.log(e.mssage)}):navigator.mediaDevices&&navigator.mediaDevices.getDisplayMedia?navigator.mediaDevices.getDisplayMedia({video:!0}).then(e=>{e.addEventListener("inactive",e=>{v.switchStream()}),v.switchStream(e,"screen")}).catch(e=>{console.log(e)}):console.log("您的浏览器暂不支持分享屏幕")},j.onclick=function(){m()},H.onclick=function(){v.unregister(),sessionStorage.clear(),e.location.replace("index.html")},k.onclick=function(e){v.switchCam()},e.onbeforeunload=function(){v&&(v.hangup(),v.unregister())},h(),e.onbeforeunload=function(){}})(window);